loadbalancer:
   build: loadbalancer
   dockerfile: Dockerfile-rpi
   ports:
   - "80:80"
eurekaserver:
   build: fb-eureka-server
   dockerfile: Dockerfile-rpi
   hostname: eurekaserver
   ports:
   - "8761:8761"
   expose:
   - "8761"
   extra_hosts:
   - "eurekaserver:192.168.178.46"
ui:
   build: fb-web
   dockerfile: Dockerfile-rpi
   ports:
   - "80:8080"
   links:
   - graphite
   - rabbitmq:messaging
   - logstash
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   extra_hosts:
   - "eurekaserver:192.168.178.46"
reportingui:
  build: fb-web-reporting
  dockerfile: Dockerfile-rpi
  ports:
  - "8999:8081"
  links:
  - graphite
  - logstash
  command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
  volumes_from: ['lsf']
  extra_hosts:
  - "eurekaserver:192.168.178.46"
invoices:
   build: fb-invoices
   dockerfile: Dockerfile-rpi
   expose:
   - "8081"
   links:
   - graphite
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   extra_hosts:
   - "eurekaserver:192.168.178.46"
expenses:
   build: fb-expenses
   dockerfile: Dockerfile-rpi
   expose:
   - "8081"
   links:
   - logstash
   - graphite
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   extra_hosts:
   - "eurekaserver:192.168.178.46"
customers:
   build: fb-customers
   dockerfile: Dockerfile-rpi
   expose:
   - "8081"
   links:
   - logstash
   - graphite
   - rabbitmq:messaging
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   extra_hosts:
   - "eurekaserver:192.168.178.46"
reporting:
   build: fb-reporting
   dockerfile: Dockerfile-rpi
   expose:
   - "8081"
   ports:
   - "9999:8081"
   links:
   - logstash
   - graphite
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   extra_hosts:
   - "eurekaserver:192.168.178.46"
templates:
   build: fb-template
   dockerfile: Dockerfile-rpi
   expose:
   - "8081"
   links:
   - mongo
   - logstash
   - graphite
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   extra_hosts:
   - "eurekaserver:192.168.178.46"
repository:
   build: fb-repository
   dockerfile: Dockerfile-rpi
   expose:
   - "8080"
   command: java -Djava.security.egd=file:/dev/./urandom -jar /sources/app.jar
   volumes_from: ['lsf']
   environment:
   - user_email
   - user_apiKey
#   - spring.profiles.active=mock
   links:
   - graphite
   - rabbitmq:messaging
   extra_hosts:
   - "eurekaserver:192.168.178.46"
lsf:
   build: logstash-forwarder
   dockerfile: Dockerfile-rpi
   links:
   - logstash
   volumes:
   - /var/log/
elasticvolume:
   dockerfile: Dockerfile-rpi
   build: elasticsearch-volume
   mem_limit: 4m
elasticsearch:
  user: root
  build: elasticsearch
  dockerfile: Dockerfile-rpi
  expose:
  - "9200"
  - "9300"
  ports:
  - "9200:9200"
  - "9300:9300"
  volumes_from: ['elasticvolume']
  mem_limit: 1g
logstash:
  build: logstash
  dockerfile: Dockerfile-rpi
  expose:
  - "5000"
  links:
   - elasticsearch:es
  mem_limit: 1g
kibana:
  build: kibana
  dockerfile: Dockerfile-rpi
  expose:
  - "80"
  ports:
  - "8090:80"
graphite:
  image: wgbartley/rpi-graphite-carbon
  ports:
  #keep this port exposed so that grafana can access it from the browser
  - "8080:80"
  #keep this port exposed so that systems with static configuration can access it
  - "2003:2003"
  - "2004:2004"
  expose:
  - "2003"
  - "2004"
  - "8080"
grafana:
  build: grafana
  dockerfile: Dockerfile-rpi
  ports:
  - "8091:80"
  links:
  - graphite
  mem_limit: 56m
mongo:
  hostname: mongo
  image: sponki/rpi-mongo
  volumes:
  - /data/db
  expose:
  - "27017"
  ports:
  - "27017:27017"
mongographite:
  build: mongo-graphite
  dockerfile: Dockerfile-rpi
  links:
  - graphite
  - mongo
  volumes_from: ['lsf']
rabbitmq:
  hostname: rabbitmq
  dockerfile: Dockerfile-rpi
  build: rabbitmq
  ports:
  - "5672:5672"
  - "15672:15672"
